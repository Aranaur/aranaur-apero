<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Science</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ігор Мірошниченко" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <script src="libs/freezeframe/freezeframe.min.js"></script>
    <script src="libs/xaringanExtra-freezeframe/freezeframe-init.js"></script>
    <script id="xaringanExtra-freezeframe-options" type="application/json">{"selector":"img[src$=\"gif\"]","trigger":"click","overlay":false,"responsive":true,"warnings":true}</script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/fabric/fabric.min.js"></script>
    <link href="libs/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link href="libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data Science
## Лекція 5: Tidyverse
### Ігор Мірошниченко
### ІІТЕ | ІК-301

---

name: toc

&lt;style type="text/css"&gt;
@media print {
  .has-continuation {
    display: block !important;
  }
}
&lt;/style&gt;



# Зміст

1. [Прогол](#prologue)

2. [Основи Tidyverse](#basics)

3. [Обробка даниз за допомогою dplyr](#dplyr)
  - [filter](#filter)
  - [arrange](#arrange)
  - [select](#select)
  - [mutate](#mutate)
  - [summarise](#summarise)
  - [joins](#joins)

4. [Чистка даних за допомогою tidyr](#tidyr)
  - [pivot_longer](#pivot_longer) / [pivot_wider](#pivot_wider)
  - [separate](#separate)
  - [unite](#unite)

5. [Висновки](#summary)


---
class: inverse, center, middle
name: prologue

# Прогол

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=1100px&gt;&lt;/html&gt;

---

# Що таке "охайні" (tidy) дані?

### Посилання:
- [Віньетка](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html) (з пакету **tidyr**)
- [Оригінальна робота](https://vita.had.co.nz/papers/tidy-data.pdf) (Hadley Wickham, 2014 JSS)

--

&lt;/br&gt;

### Ключові моменти:
1. Кожна змінна в окремому стовпеці.
2. Кожне спостереження в окремому ряду.
3. Кожна одиниця спостереження в коремій комірці.

--

&lt;/br&gt;

В основному, tidy дані, швидше за все, мають [довгий формат](https://en.wikipedia.org/wiki/Wide_and_narrow_data) ніж широкий формат.

---

# Чекліст

### Пакети на сьогодні

☑ [**tidyverse**](https://www.tidyverse.org/)

☑ [**nycflights13**](hhttps://github.com/hadley/nycflights13)

--

&lt;/br&gt;

Поки що я пропишу завантаження цих бібліотек. Але ви можете встановити/оновити їх за допомогою наступної команди.

```r
install.packages(c('tidyverse', 'nycflights13'), repos = 'https://cran.rstudio.com', dependencies  = TRUE)
```

**Порада.** Якщо ви використовуєте Linux, я _настійно_ рекомендую встановити попередньо скомпільовані двійкові версії цих пакетів із [RSPM](https://packagemanager.rstudio.com/client/#/repos/1/ огляд) замість CRAN. Точне дзеркало репо залежить від дистрибутива (див. посилання). Але в Ubuntu 20.04, наприклад, ви б використовував:

```r
install.packages(c('tidyverse', 'nycflights13'), repos = 'https://packagemanager.rstudio.com/all/__linux__/focal/latest', dependencies  = TRUE)
```

---
class: inverse, center, middle
name: basics

# Основи Tidyverse

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=1100px&gt;&lt;/html&gt;

---

# Tidyverse vs. base R

Багато чого було написано з приводу дебатів "tidyverse vs. base R".

--

Я не буду тут заглиблюватися в цю дискусію, тому що я думаю, що відповідь [чітка](http://varianceexplained.org/r/teach-tidyverse/): Ми повинні спочатку навчити tidyverse (або, принаймні, на початку) .
- Чудова документація та підтримка спільноти. 
- Наявність послідовної філософії та синтаксису полегшує навчання.
- Забезпечує зручний "інтерфейс" для інструментів великих даних, які ми будемо використовувати пізніше в курсі.
- Для очищення даних, обробки та побудови графіків, tidyverse справді неважка.&lt;sup&gt;1&lt;/sup&gt;

.footnote[
&lt;sup&gt;1&lt;/sup&gt; Слід згадати і про [**data.table**](http://r-datatable.com/). Це пакет для відносно великих об'ємів даних. Можливо цей пакет буде предметом нашої наступної лекції.
]

--

**Але**... це, безумовно, не повинно відштовхувати вас від вивчення альтернатив base R.
- Base  R надзвичайно гнучкий та потужний (і стабільний).
- Є деякі речі, заради яких вам доведеться вийти за межі tidyverse.
- Комбінація tidyverse + data.table + base R покриває більшу частку задач data science.
- Чудові посібники з маніпулювання даними на base R: [тут](https://www.rspatial.org/intr/index.html) і [тут](https://github.com/matloff/fasteR).

---

# Tidyverse vs. base R (прод.)

Однією з зручностей є те, що часто існує пряма відповідність між командою tidyverse та її базовим еквівалентом R.

Зазвичай вони відповідають правилу "tidyverse::snake_case" і "base::period.case". напр. Порівняти:

| tidyverse  |  base |
|---|---|
| `?readr::read_csv`  | `?utils::read.csv` |
|  `?dplyr::if_else` |  `?base::ifelse` |
|  `?tibble::tibble` |  `?base::data.frame` |
Тощо.
  
Якщо ви викличете наведені вище приклади, ви побачите, що альтернатива tidyverse зазвичай пропонує деякі покращення або інші корисні опції (а іноді й обмеження) порівняно з базовим аналогом.

--

**Пам’ятайте:** (Майже) завжди є кілька способів досягнення поставленої мети в R.

---

# Tidyverse пакети

Давайте завантажимо мета-пакет tidyverse і перевіримо результат.

```r
library(tidyverse)
```

```
## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
```

```
## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.6     v dplyr   1.0.8
## v tidyr   1.2.0     v stringr 1.4.0
## v readr   2.1.2     v forcats 0.5.1
```

```
## Warning: package 'tibble' was built under R version 4.1.2
```

```
## Warning: package 'tidyr' was built under R version 4.1.2
```

```
## Warning: package 'readr' was built under R version 4.1.2
```

```
## Warning: package 'dplyr' was built under R version 4.1.2
```

```
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
```

--

Бачимо, що ми завантажили декілька пакетів (які також можна завантажувати окремо): **ggplot2**, **tibble**, **dplyr** тощо.
- Ми також можемо побачити інформацію про версії пакетів та деякі [конфлікти простору імен](https://raw.githack.com/uo-ec607/lectures/master/04-rlang/04-rlang.html#59).

---

# Tidyverse пакети (прод.)

Tidyverse насправді містить набагато більше пакетів, ніж ті, які просто завантажуються автоматично.&lt;sup&gt;1&lt;/sup&gt;

```r
tidyverse_packages()
```

```
##  [1] "broom"         "cli"           "crayon"        "dbplyr"       
##  [5] "dplyr"         "dtplyr"        "forcats"       "googledrive"  
##  [9] "googlesheets4" "ggplot2"       "haven"         "hms"          
## [13] "httr"          "jsonlite"      "lubridate"     "magrittr"     
## [17] "modelr"        "pillar"        "purrr"         "readr"        
## [21] "readxl"        "reprex"        "rlang"         "rstudioapi"   
## [25] "rvest"         "stringr"       "tibble"        "tidyr"        
## [29] "xml2"          "tidyverse"
```

Ми будемо використовувати декілька з цих додаткових пакетів протягом курсу.

- Напр. пакет **lubridate** для роботи з датами і пакет **rvest** для веб-скрейпінгу.
– Однак майте на увазі, що ці пакети доведеться завантажувати окремо.

.footnote[
&lt;sup&gt;1&lt;/sup&gt; Він також включає *багато* залежностей під час встановлення. Це питання деяких [суперечок](http://www.tinyverse.org/).
]

---

# Tidyverse пакети (прод.)

Я сподіваюся охопити більшість пакетів tidyverse протягом усього курсу.

Однак сьогодні я зупинюся лише на двох пакетах:
1. [**dplyr**](https://dplyr.tidyverse.org/)
2. [**tidyr**](https://tidyr.tidyverse.org/)

Це пакети робочі конячки для очищення та обробки даних. Таким чином, ви, ймовірно, найбільше використовуєте їх (разом із **ggplot2**, з яким ми вже зустрічалися на перших лекціях).
- Очищення даних і обробка займають непомірно багато часу, незалежно від того, де ви перебуваєте у своїй дослідницькій кар’єрі.

---

# Пайпи (pipes): %&gt;%

Tidyverse завантажує власний оператор конвейера, `%&gt;%`.
  
Я хочу показати, наскільки круті пайпи і як їх використання може значно покращити читання та написання коду. Порівняти:


```r
## Ці наступні два рядки коду роблять те саме.
mpg %&gt;% filter(manufacturer=="audi") %&gt;% group_by(model) %&gt;% summarise(hwy_mean = mean(hwy))
summarise(group_by(filter(mpg, manufacturer=="audi"), model), hwy_mean = mean(hwy))
```

--

Перший рядок читається зліва направо, саме так я думав про операції в моїй голові.
- Візьміть цей об'єкт (`mpg`), зробіть це (`filter`), потім зробіть це (`group_by`) тощо.

Другий рядок повністю інвертує цей логічний порядок (першою йде остання операція!)
- Хто хоче читати речі навиворіт?

---

# Пайпи (pipes): %&gt;% (прод.)

Інший приклад:


```r
1:10 %&gt;% 
  sin() %&gt;% 
  abs() %&gt;% 
  sqrt() %&gt;% 
  sort()

sort(sqrt(abs(sin(1:10))))
```

---

# Пайпи (pipes): %&gt;% (прод.)

Версія коду з пайпами стає ще більш читабельною, якщо написати її в кілька рядків.


```r
mpg %&gt;% 
  filter(manufacturer=="audi") %&gt;% 
  group_by(model) %&gt;% 
  summarise(hwy_mean = mean(hwy))
```

```
## # A tibble: 3 x 2
##   model      hwy_mean
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 a4             28.3
## 2 a4 quattro     25.8
## 3 a6 quattro     24
```

Пам’ятайте: використання вертикального простору нічого не коштує і робить код набагато більш читабельним/записуваним, ніж горизонтальний запис.

--

PS — пайпи походить із пакету [**magrittr**](https://magrittr.tidyverse.org/) ([geddit?](https://en.wikipedia.org/wiki/The_Treachery_of_Images)), який може робити інші цікаві речі.

---
name: nativepipe

# Базовий пайп R: |&gt;

Пайп magrittr виявився настільки успішним і популярним, що основна команда R [нещодавно анонсувала](https://t.co/HVECPENQ5C?amp=1) "рідну" версію пайпу в базі R, записується як `|&gt; `.&lt;sup&gt;1&lt;/sup&gt; Наприклад:

```r
mtcars |&gt; subset(cyl==4) |&gt; head()
mtcars |&gt; subset(cyl==4) |&gt; d =&gt; lm(mpg ~ disp, data = d)
```

.footnote[&lt;sup&gt;1&lt;/sup&gt; Насправді це `|`, за яким слідує `&gt;`. Шрифт за замовчуванням на цих слайдах робить його таким "вишуканим".]

--

Цей нативний пайп доповнює деякі інші нові цікаві функції, наприклад підтримка [«лямбда» функцій](https://stackoverflow.com/questions/16501/what-is-a-lambda-function) у R.

---
class: inverse, center, middle
name: dplyr

# dplyr

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=1100px&gt;&lt;/html&gt;

---

# dplyr 1.0.0 реліз

Деякі з функцій **dplyr**, які ми сьогодні розглянемо, були представлені у [версії 1.0.0](https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/) пакету.
- Перш ніж продовжити, переконайтеся, що ви використовуєте принаймні **dplyr** 1.0.0.


```r
packageVersion('dplyr')
```

```
## [1] '1.0.8'
```

```r
# install.packages('dplyr') ## install updated version if &lt; 1.0.0
```

---

# Основні функції dplyr

Є п’ять ключових функція dplyr, які вам потрібно вивчити.

1. `filter`: фільтація по рядкам

2. `arrange`: впорядкування по рядкам

3. `select`: вибір стовпчиків за назвою

4. `mutate`: створення нових стовпчиків

5. `summarise`: агрегація даних.&lt;sup&gt;1&lt;/sup&gt;

.footnote[
&lt;sup&gt;1&lt;/sup&gt; `summarize` через "z" також працює.
]

--

&lt;/br&gt;
Давайте разом практикуємо ці команди, використовуючи датасет `starwars`, який поставляється з dplyr.

---
name: filter

# 1) dplyr::filter

Ми можемо об’єднати кілька команд фільтра в пайп (`%&gt;%`) або просто розділити їх в одній команді фільтра за допомогою коми.

```r
starwars %&gt;% 
  filter( 
    species == "Human", 
    height &gt;= 190
    ) 
```

```
## # A tibble: 4 x 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Darth Va~    202   136 none       white      yellow          41.9 male  mascu~
## 2 Qui-Gon ~    193    89 brown      fair       blue            92   male  mascu~
## 3 Dooku        193    80 white      fair       brown          102   male  mascu~
## 4 Bail Pre~    191    NA black      tan        brown           67   male  mascu~
## # ... with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 1) dplyr::filter *прод.*

Регулярні вирази також добре працюють.

```r
starwars %&gt;% 
  filter(grepl("Skywalker", name))
```

```
## # A tibble: 3 x 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sky~    172    77 blond      fair       blue            19   male  mascu~
## 2 Anakin S~    188    84 blond      fair       blue            41.9 male  mascu~
## 3 Shmi Sky~    163    NA black      fair       brown           72   fema~ femin~
## # ... with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 1) dplyr::filter *прод.*

Дуже поширеним випадком використання `filter` є виявлення (або видалення) пропущених значень.

```r
starwars %&gt;% 
  filter(is.na(height))
```

```
## # A tibble: 6 x 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Arvel Cr~     NA    NA brown      fair       brown             NA male  mascu~
## 2 Finn          NA    NA black      dark       dark              NA male  mascu~
## 3 Rey           NA    NA brown      light      hazel             NA fema~ femin~
## 4 Poe Dame~     NA    NA brown      light      brown             NA male  mascu~
## 5 BB8           NA    NA none       none       black             NA none  mascu~
## 6 Captain ~     NA    NA unknown    unknown    unknown           NA &lt;NA&gt;  &lt;NA&gt;  
## # ... with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

--

&lt;/br&gt;

Щоб видалити відсутні спостереження, просто використовуйте заперечення: `filter(!is.na(height))`.
Або `drop_na(height)`.
Спробуйте самі.

---
name: arrange

# 2) dplyr::arrange


```r
starwars %&gt;% 
  arrange(birth_year)
```

```
## # A tibble: 87 x 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Wicket ~     88  20   brown      brown      brown            8   male  mascu~
##  2 IG-88       200 140   none       metal      red             15   none  mascu~
##  3 Luke Sk~    172  77   blond      fair       blue            19   male  mascu~
##  4 Leia Or~    150  49   brown      light      brown           19   fema~ femin~
##  5 Wedge A~    170  77   brown      fair       hazel           21   male  mascu~
##  6 Plo Koon    188  80   none       orange     black           22   male  mascu~
##  7 Biggs D~    183  84   black      light      brown           24   male  mascu~
##  8 Han Solo    180  80   brown      fair       brown           29   male  mascu~
##  9 Lando C~    177  79   black      dark       brown           31   male  mascu~
## 10 Boba Fe~    183  78.2 black      fair       brown           31.5 male  mascu~
## # ... with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

--

*Примітка.* Впорядкування по стовпчику з символами (тобто &lt;chr&gt;) буде сортуватися за алфавітом.

---

# 2) dplyr::arrange *прод.*

Ми також можемо розташувати елементи в порядку спадання за допомогою `arrange(desc())`.

```r
starwars %&gt;% 
  arrange(desc(birth_year))
```

```
## # A tibble: 87 x 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascu~
##  2 Jabba D~    175  1358 &lt;NA&gt;       green-tan~ orange           600 herm~ mascu~
##  3 Chewbac~    228   112 brown      unknown    blue             200 male  mascu~
##  4 C-3PO       167    75 &lt;NA&gt;       gold       yellow           112 none  mascu~
##  5 Dooku       193    80 white      fair       brown            102 male  mascu~
##  6 Qui-Gon~    193    89 brown      fair       blue              92 male  mascu~
##  7 Ki-Adi-~    198    82 white      pale       yellow            92 male  mascu~
##  8 Finis V~    170    NA blond      fair       blue              91 male  mascu~
##  9 Palpati~    170    75 grey       pale       yellow            82 male  mascu~
## 10 Cliegg ~    183    NA brown      fair       blue              82 male  mascu~
## # ... with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: select

# 3) dplyr::select

Використовуйте кому, щоб вибрати кілька стовпців із дата фрейму. (Ви також можете використовувати «перший:останній» для послідовних стовпців). Пропустити стовпчику можна за допомогою символу «-».

```r
starwars %&gt;% 
  select(name:skin_color, species, -height)
```

```
## # A tibble: 87 x 5
##    name                mass hair_color    skin_color  species
##    &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;  
##  1 Luke Skywalker        77 blond         fair        Human  
##  2 C-3PO                 75 &lt;NA&gt;          gold        Droid  
##  3 R2-D2                 32 &lt;NA&gt;          white, blue Droid  
##  4 Darth Vader          136 none          white       Human  
##  5 Leia Organa           49 brown         light       Human  
##  6 Owen Lars            120 brown, grey   light       Human  
##  7 Beru Whitesun lars    75 brown         light       Human  
##  8 R5-D4                 32 &lt;NA&gt;          white, red  Droid  
##  9 Biggs Darklighter     84 black         light       Human  
## 10 Obi-Wan Kenobi        77 auburn, white fair        Human  
## # ... with 77 more rows
```

---

# 3) dplyr::select *прод.*

Ви також можете перейменувати деякі (або всі) вибрані змінні на місці.

```r
starwars %&gt;%
  select(alias=name, crib=homeworld, sex=gender) 
```

```
## # A tibble: 87 x 3
##    alias              crib     sex      
##    &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;    
##  1 Luke Skywalker     Tatooine masculine
##  2 C-3PO              Tatooine masculine
##  3 R2-D2              Naboo    masculine
##  4 Darth Vader        Tatooine masculine
##  5 Leia Organa        Alderaan feminine 
##  6 Owen Lars          Tatooine masculine
##  7 Beru Whitesun lars Tatooine feminine 
##  8 R5-D4              Tatooine masculine
##  9 Biggs Darklighter  Tatooine masculine
## 10 Obi-Wan Kenobi     Stewjon  masculine
## # ... with 77 more rows
```

--

Якщо ви просто хочете перейменувати стовпці, не створюючи їх піднаборів, ви можете використовувати `rename`. Спробуйте, замінивши `select(...)` у наведеному вище фрагменті коду на `rename(...)`.

---

# 3) dplyr::select *прод.*

Параметр `select(contains(PATTERN))` забезпечує знаходження стовпчика за паттерном.

```r
starwars %&gt;% 
  select(name, contains("color"))
```

```
## # A tibble: 87 x 4
##    name               hair_color    skin_color  eye_color
##    &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker     blond         fair        blue     
##  2 C-3PO              &lt;NA&gt;          gold        yellow   
##  3 R2-D2              &lt;NA&gt;          white, blue red      
##  4 Darth Vader        none          white       yellow   
##  5 Leia Organa        brown         light       brown    
##  6 Owen Lars          brown, grey   light       blue     
##  7 Beru Whitesun lars brown         light       blue     
##  8 R5-D4              &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter  black         light       brown    
## 10 Obi-Wan Kenobi     auburn, white fair        blue-gray
## # ... with 77 more rows
```

---

# 3) dplyr::select *прод.*

Параметр `select(..., everything())` є ще одним корисним варіантом, якщо ви хочете лише перенести деякі змінні на "передню частину" фрейму даних.

```r
starwars %&gt;% 
  select(species, homeworld, everything()) %&gt;%
  head(5)
```

```
## # A tibble: 5 x 14
##   species homeworld name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 Human   Tatooine  Luke Skywalker    172    77 blond      fair        blue     
## 2 Droid   Tatooine  C-3PO             167    75 &lt;NA&gt;       gold        yellow   
## 3 Droid   Naboo     R2-D2              96    32 &lt;NA&gt;       white, blue red      
## 4 Human   Tatooine  Darth Vader       202   136 none       white       yellow   
## 5 Human   Alderaan  Leia Organa       150    49 brown      light       brown    
## # ... with 6 more variables: birth_year &lt;dbl&gt;, sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;
```

--

&lt;/br&gt;
*Примітка:* Нова функція `relocate`, доступна в dplyr 1.0.0, принесла набагато більше функціональних можливостей для впорядкування стовпців. Дивіться [тут](https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-select-rename-relocate/).

---
name: mutate

# 4) dplyr::mutate

Ви можете створювати нові стовпці з нуля або (частіше) як перетворення існуючих стовпців.

```r
starwars %&gt;% 
  select(name, birth_year) %&gt;%
  mutate(dog_years = birth_year * 7) %&gt;%
  mutate(comment = paste0(name, " is ", dog_years, " in dog years."))
```

```
## # A tibble: 87 x 4
##    name               birth_year dog_years comment                              
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                
##  1 Luke Skywalker           19        133  Luke Skywalker is 133 in dog years.  
##  2 C-3PO                   112        784  C-3PO is 784 in dog years.           
##  3 R2-D2                    33        231  R2-D2 is 231 in dog years.           
##  4 Darth Vader              41.9      293. Darth Vader is 293.3 in dog years.   
##  5 Leia Organa              19        133  Leia Organa is 133 in dog years.     
##  6 Owen Lars                52        364  Owen Lars is 364 in dog years.       
##  7 Beru Whitesun lars       47        329  Beru Whitesun lars is 329 in dog yea~
##  8 R5-D4                    NA         NA  R5-D4 is NA in dog years.            
##  9 Biggs Darklighter        24        168  Biggs Darklighter is 168 in dog year~
## 10 Obi-Wan Kenobi           57        399  Obi-Wan Kenobi is 399 in dog years.  
## # ... with 77 more rows
```

---


# 4) dplyr::mutate *прод.*

*Примітка:* `mutate` залежить від порядку. Таким чином, ви можете поєднувати кілька мутацій за один раз.

```r
starwars %&gt;% 
  select(name, birth_year) %&gt;%
  mutate(
    dog_years = birth_year * 7, ## Розділяємо комою
    comment = paste0(name, " is ", dog_years, " in dog years.")
    )
```

```
## # A tibble: 87 x 4
##    name               birth_year dog_years comment                              
##    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                
##  1 Luke Skywalker           19        133  Luke Skywalker is 133 in dog years.  
##  2 C-3PO                   112        784  C-3PO is 784 in dog years.           
##  3 R2-D2                    33        231  R2-D2 is 231 in dog years.           
##  4 Darth Vader              41.9      293. Darth Vader is 293.3 in dog years.   
##  5 Leia Organa              19        133  Leia Organa is 133 in dog years.     
##  6 Owen Lars                52        364  Owen Lars is 364 in dog years.       
##  7 Beru Whitesun lars       47        329  Beru Whitesun lars is 329 in dog yea~
##  8 R5-D4                    NA         NA  R5-D4 is NA in dog years.            
##  9 Biggs Darklighter        24        168  Biggs Darklighter is 168 in dog year~
## 10 Obi-Wan Kenobi           57        399  Obi-Wan Kenobi is 399 in dog years.  
## # ... with 77 more rows
```

---

# 4) dplyr::mutate *прод.*

Булеві, логічні та умовні оператори також добре працюють із `mutate`.

```r
starwars %&gt;% 
  select(name, height) %&gt;%
  filter(name %in% c("Luke Skywalker", "Anakin Skywalker")) %&gt;% 
  mutate(tall1 = height &gt; 180) %&gt;%
  mutate(tall2 = ifelse(height &gt; 180, "Tall", "Short")) ## Той самий ефект, але можна вибрати групи
```

```
## # A tibble: 2 x 4
##   name             height tall1 tall2
##   &lt;chr&gt;             &lt;int&gt; &lt;lgl&gt; &lt;chr&gt;
## 1 Luke Skywalker      172 FALSE Short
## 2 Anakin Skywalker    188 TRUE  Tall
```

---

# 4) dplyr::mutate *прод.*

Нарешті, поєднання `mutate` з функцією `across` у dplyr 1.0.0+ дозволяє вам легко працювати з підмножиною змінних. Наприклад:


```r
starwars %&gt;% 
  select(name:eye_color) %&gt;% 
* mutate(across(where(is.character), toupper)) %&gt;%
  head(5)
```

```
## # A tibble: 5 x 6
##   name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 LUKE SKYWALKER    172    77 BLOND      FAIR        BLUE     
## 2 C-3PO             167    75 &lt;NA&gt;       GOLD        YELLOW   
## 3 R2-D2              96    32 &lt;NA&gt;       WHITE, BLUE RED      
## 4 DARTH VADER       202   136 NONE       WHITE       YELLOW   
## 5 LEIA ORGANA       150    49 BROWN      LIGHT       BROWN
```

--

&lt;/br&gt;
*Примітка.* Цей робочий процес (тобто поєднання `mutate` та `across`) замінює старі варіанти `mutate`, які ви, можливо, використовували раніше. Детальніше [тут](https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/) і [тут](https://dplyr.tidyverse.org/dev/articles/colwise.html).

---
name: summarise

# 5) dplyr::summarise

Особливо корисно в поєднанні з функцією `group_by`.

```r
starwars %&gt;% 
  group_by(species, gender) %&gt;% 
  summarise(mean_height = mean(height, na.rm = TRUE))
```

```
## `summarise()` has grouped output by 'species'. You can override using the
## `.groups` argument.
```

```
## # A tibble: 42 x 3
## # Groups:   species [38]
##    species   gender    mean_height
##    &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
##  1 Aleena    masculine          79
##  2 Besalisk  masculine         198
##  3 Cerean    masculine         198
##  4 Chagrian  masculine         196
##  5 Clawdite  feminine          168
##  6 Droid     feminine           96
##  7 Droid     masculine         140
##  8 Dug       masculine         112
##  9 Ewok      masculine          88
## 10 Geonosian masculine         183
## # ... with 32 more rows
```

---

# 5) dplyr::summarise *прод.*

Зауважте, що аргумент `na.rm = TRUE` є хорошою практикою при агрегації. В іншому випадку будь-яке пропущене значення також пошириться на підсумкове значення.

```r
## Мабуть, не те, що ми хочемо
starwars %&gt;% 
  summarise(mean_height = mean(height))
```

```
## # A tibble: 1 x 1
##   mean_height
##         &lt;dbl&gt;
## 1          NA
```

```r
## Набагато краще
starwars %&gt;% 
  summarise(mean_height = mean(height, na.rm = TRUE))
```

```
## # A tibble: 1 x 1
##   mean_height
##         &lt;dbl&gt;
## 1        174.
```

---

# 5) dplyr::summarise *прод.*

Той самий `across`-подібний процес, який ми бачили за допомогою `mutate` кілька слайдів назад, також працює з `summarise`. Наприклад:


```r
starwars %&gt;% 
  group_by(species) %&gt;% 
* summarise(across(where(is.numeric), mean, na.rm=T)) %&gt;%
  head(5)
```

```
## # A tibble: 5 x 4
##   species  height  mass birth_year
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 Aleena       79    15        NaN
## 2 Besalisk    198   102        NaN
## 3 Cerean      198    82         92
## 4 Chagrian    196   NaN        NaN
## 5 Clawdite    168    55        NaN
```

--

&lt;/br&gt;
*Примітка.* Знову ж таки, ця функція замінює старі варіанти «суммаризації», які ви використовували до dplyr 1.0.0. Деталі [тут](https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/) і [тут](https://dplyr.tidyverse.org/dev/articles /colwise.html).

---

# Інші смаколики dplyr

`group_by` та `ungroup`: для (роз)групування.
- Як ми вже бачили, особливо корисно з командами `summarise` та `mutate`.

--

`slice`: підмножина рядків за позицією, а не фільтрація за значеннями.
- Напр. `starwars %&gt;% slice(c(1, 5))`

--

`pull`: витягніть стовпець із дата фрейму у вигляді вектора або скаляра.
- Напр. `starwars %&gt;% filter(gender=="female") %&gt;% pull(height)`

--

`count` і `distinct`: кількість та унікальні спостереження.
- Напр. `starwars %&gt;% count(species)`, або `starwars %&gt;% distinct(species)`
- Ви також можете використовувати комбінацію `mutate`, `group_by` та `n()`, напр. `starwars %&gt;% group_by(species) %&gt;% mutate(num = n())`.


---

# Інші смаколики dplyr (прод.)

Існує також цілий клас [віконних функцій](https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html) для отримання попередніх, наступних значень, ранжирування, створення кумулятивних агрегатів, тощо
- Див. `vignette("window-functions")`.

--

&lt;/br&gt;

Остаточний набір «корисних» dplyr — це сімейство операцій join.
– Ми будемо зустрічатися і практикувати це ще багато разів у міру проходження курсу.


---
name: joins

# Joins

Однією з основ пакету dplyr є об’єднання даних семейством [функцій join](https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html).
- `inner_join(df1, df2)`
- `left_join(df1, df2)`
- `right_join(df1, df2)`
- `full_join(df1, df2)`
- `semi_join(df1, df2)`
- `anti_join(df1, df2)`

(Буде корисно побачити візуальні зображення різних операцій об’єднання [тут](https://r4ds.had.co.nz/relational-data.html).)

--

Для простих прикладів, які я збираюся показати тут, нам знадобляться деякі набори даних, які постачаються разом із пакетом [**nycflights13**](http://github.com/hadley/nycflights13).
- Завантажте його зараз, а потім перевірте ці фрейми даних у власній консолі.


```
## Warning: package 'nycflights13' was built under R version 4.1.3
```

```r
library(nycflights13)
flights 
planes
```

---

# Joins (прод.)

Давайте виконаємо [left join](https://stat545.com/bit001_dplyr-cheatsheet.html#left_joinsuperheroes-publishers) для наборів даних польотів і літаків.
- *Примітка*: я збираюся підмножити стовпці після об’єднання, але лише для того, щоб текст залишався на слайді.

--


```r
left_join(flights, planes) %&gt;%
  select(year, month, day, dep_time, arr_time, carrier, flight, tailnum, type, model)
```

```
## Joining, by = c("year", "tailnum")
```

```
## # A tibble: 336,776 x 10
##     year month   day dep_time arr_time carrier flight tailnum type  model
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
##  1  2013     1     1      517      830 UA        1545 N14228  &lt;NA&gt;  &lt;NA&gt; 
##  2  2013     1     1      533      850 UA        1714 N24211  &lt;NA&gt;  &lt;NA&gt; 
##  3  2013     1     1      542      923 AA        1141 N619AA  &lt;NA&gt;  &lt;NA&gt; 
##  4  2013     1     1      544     1004 B6         725 N804JB  &lt;NA&gt;  &lt;NA&gt; 
##  5  2013     1     1      554      812 DL         461 N668DN  &lt;NA&gt;  &lt;NA&gt; 
##  6  2013     1     1      554      740 UA        1696 N39463  &lt;NA&gt;  &lt;NA&gt; 
##  7  2013     1     1      555      913 B6         507 N516JB  &lt;NA&gt;  &lt;NA&gt; 
##  8  2013     1     1      557      709 EV        5708 N829AS  &lt;NA&gt;  &lt;NA&gt; 
##  9  2013     1     1      557      838 B6          79 N593JB  &lt;NA&gt;  &lt;NA&gt; 
## 10  2013     1     1      558      753 AA         301 N3ALAA  &lt;NA&gt;  &lt;NA&gt; 
## # ... with 336,766 more rows
```

---

# Joins (прод.)

(*продовження з попереднього слайда*)

Зауважте, що dplyr зробив розумні припущення щодо того, до яких стовпців приєднатися (тобто стовпців з однаковою назвою). Він також повідомив нам свій вибір:

```
*## Joining, by = c("year", "tailnum")
```

Однак тут є очевидна проблема: змінна «year» не має узгодженого значення для наших об’єднаних наборів даних!
- В одному це означає *рік польоту*, в іншому — *рік побудови*.

--

На щастя, є простий спосіб уникнути цієї проблеми.
- Подивіться, чи зможете ви розібратися, перш ніж переходити до наступного слайда.
- Спробуйте `?dplyr::join`.

---

# Joins (прод.)

(*продовження з попереднього слайда*)

Вам просто потрібно бути більш чітким у виклику приєднання, використовуючи аргумент `by = `.
- Ви також можете перейменувати будь-які неоднозначні стовпці, щоб уникнути плутанини.

```r
left_join(
  flights,
  planes %&gt;% rename(year_built = year), ## Не обов’язково, але корисно
  by = "tailnum" ## Вказуємо стовпчик
  ) %&gt;%
  select(year, month, day, dep_time, arr_time, carrier, flight, tailnum, year_built, type, model) %&gt;%
  head(3) ## Просто для економії вертикального простору на слайді
```

```
## # A tibble: 3 x 11
##    year month   day dep_time arr_time carrier flight tailnum year_built type    
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;   
## 1  2013     1     1      517      830 UA        1545 N14228        1999 Fixed w~
## 2  2013     1     1      533      850 UA        1714 N24211        1998 Fixed w~
## 3  2013     1     1      542      923 AA        1141 N619AA        1990 Fixed w~
## # ... with 1 more variable: model &lt;chr&gt;
```

---

# Joins (прод.)

(*продовження з попереднього слайда*)

Останнє, що я зараз згадаю; зауважте, що станеться, якщо ми знову вказати стовпець об’єднання... але не перейменуйте неоднозначний стовпець «year» принаймні в одному з наведених кадрів даних.

```r
left_join(
  flights,
  planes, ## Цього разу не перейменовуємо "year" на "year_built".
  by = "tailnum"
  ) %&gt;%
  select(contains("year"), month, day, dep_time, arr_time, carrier, flight, tailnum, type, model) %&gt;%
  head(3)
```

```
## # A tibble: 3 x 11
##   year.x year.y month   day dep_time arr_time carrier flight tailnum type  model
##    &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1   2013   1999     1     1      517      830 UA        1545 N14228  Fixe~ 737-~
## 2   2013   1998     1     1      533      850 UA        1714 N24211  Fixe~ 737-~
## 3   2013   1990     1     1      542      923 AA        1141 N619AA  Fixe~ 757-~
```

--

Переконайтеся, що ви знаєте, що таке "year.x" і "year.y".

---
class: inverse, center, middle
name: tidyr

# tidyr

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=1100px&gt;&lt;/html&gt;

---

# Ключові функції tidyr

1. `pivot_longer`: перевести широкий формат в довгий.&lt;sup&gt;1&lt;/sup&gt; 

2. `pivot_wider`: довгий формат в широкий.&lt;sup&gt;2&lt;/sup&gt; 

3. `separate`: поділ одного стовпчика на декілька

4. `unite`: об'єднання декількох стовпчиків в один

.footnote[
&lt;sup&gt;1&lt;/sup&gt; Оновлена версія `tidyr::gather`.

&lt;sup&gt;2&lt;/sup&gt; Оновлена версія `tidyr::spread`.
]  
  
---
name: pivot_longer

# 1) tidyr::pivot_longer


```r
stocks &lt;- data.frame( ## Можна використовувати "tibble" замість "data.frame", якщо хочете
  time = as.Date('2009-01-01') + 0:1,
  X = rnorm(2, 0, 1),
  Y = rnorm(2, 0, 2),
  Z = rnorm(2, 0, 4)
  )
stocks
```

```
##         time          X          Y        Z
## 1 2009-01-01 -0.4692537 -0.7079315 5.054850
## 2 2009-01-02  1.6336806 -0.1889489 5.227395
```

```r
stocks %&gt;% pivot_longer(-time, names_to="stock", values_to="price")
```

```
## # A tibble: 6 x 3
##   time       stock  price
##   &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
## 1 2009-01-01 X     -0.469
## 2 2009-01-01 Y     -0.708
## 3 2009-01-01 Z      5.05 
## 4 2009-01-02 X      1.63 
## 5 2009-01-02 Y     -0.189
## 6 2009-01-02 Z      5.23
```

---

# 1) tidyr::pivot_longer *прод.*

Давайте швидко збережемо «охайний» (тобто довгий) дата фрейм.


```r
tidy_stocks &lt;- 
  stocks %&gt;% 
  pivot_longer(-time, names_to="stock", values_to="price")
```

---
name: pivot_wider

# 2) tidyr::pivot_wider


```r
tidy_stocks %&gt;% pivot_wider(names_from=stock, values_from=price)
```

```
## # A tibble: 2 x 4
##   time            X      Y     Z
##   &lt;date&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 2009-01-01 -0.469 -0.708  5.05
## 2 2009-01-02  1.63  -0.189  5.23
```

```r
tidy_stocks %&gt;% pivot_wider(names_from=time, values_from=price)
```

```
## # A tibble: 3 x 3
##   stock `2009-01-01` `2009-01-02`
##   &lt;chr&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 X           -0.469        1.63 
## 2 Y           -0.708       -0.189
## 3 Z            5.05         5.23
```

---
name: separate

# 3) tidyr::separate


```r
economists &lt;- data.frame(name = c("Adam.Smith", "Paul.Samuelson", "Milton.Friedman"))
economists
```

```
##              name
## 1      Adam.Smith
## 2  Paul.Samuelson
## 3 Milton.Friedman
```

```r
economists %&gt;% separate(name, c("first_name", "last_name")) 
```

```
##   first_name last_name
## 1       Adam     Smith
## 2       Paul Samuelson
## 3     Milton  Friedman
```

--

&lt;/br&gt;

Ця команда досить розумна. Але щоб уникнути двозначності, ви також можете вказати розділовий символ за допомогою `separate(..., sep=".")`.

---

# 3) tidyr::separate *прод.*

Пов’язаною функцією є `separate_rows` для поділу комірок, які містять кілька полів або спостережень.


```r
jobs &lt;- data.frame(
  name = c("Марічка", "Мар'ян"),
  occupation = c("Домогосподарка", "Філософ, Філантроп, Філателіст")
  ) 
jobs
```

```
##      name                     occupation
## 1 Марічка                 Домогосподарка
## 2  Мар'ян Філософ, Філантроп, Філателіст
```

```r
## Тепер розділіть різні професії Марічки на різні рядки
jobs %&gt;% separate_rows(occupation)
```

```
## # A tibble: 4 x 2
##   name    occupation    
##   &lt;chr&gt;   &lt;chr&gt;         
## 1 Марічка Домогосподарка
## 2 Мар'ян  Філософ       
## 3 Мар'ян  Філантроп     
## 4 Мар'ян  Філателіст
```

---
name: unite

# 4) tidyr::unite


```r
gdp = data.frame(
  yr = rep(2016, times = 4),
  mnth = rep(1, times = 4),
  dy = 1:4,
  gdp = rnorm(4, mean = 100, sd = 2)
  )
gdp 
```

```
##     yr mnth dy       gdp
## 1 2016    1  1  97.25947
## 2 2016    1  2 101.26314
## 3 2016    1  3 100.38945
## 4 2016    1  4  97.13708
```

```r
## Combine "yr", "mnth", and "dy" into one "date" column
gdp %&gt;% unite(date, c("yr", "mnth", "dy"), sep = "-")
```

```
##       date       gdp
## 1 2016-1-1  97.25947
## 2 2016-1-2 101.26314
## 3 2016-1-3 100.38945
## 4 2016-1-4  97.13708
```

---

# 4) tidyr::unite *прод.*

Зверніть увагу, що `unite` автоматично створить строкову змінну. Ви можете побачити це краще, якщо ми перетворимо його на tibble.

```r
gdp_u &lt;- gdp %&gt;% unite(date, c("yr", "mnth", "dy"), sep = "-") %&gt;% as_tibble()
gdp_u
```

```
## # A tibble: 4 x 2
##   date       gdp
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 2016-1-1  97.3
## 2 2016-1-2 101. 
## 3 2016-1-3 100. 
## 4 2016-1-4  97.1
```

--

Якщо ви хочете перетворити його на щось інше (наприклад, дату чи число), вам потрібно буде змінити його за допомогою `mutate`. Перегляньте наступний слайд для прикладу, використовуючи надзвичайно корисні функції для роботи з датами з пакету [lubridate](https://lubridate.tidyverse.org/).

---

# 4) tidyr::unite *прод.*

*(продовження попереднього слайду)*


```r
library(lubridate)
gdp_u %&gt;% mutate(date = ymd(date))
```

```
## # A tibble: 4 x 2
##   date         gdp
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2016-01-01  97.3
## 2 2016-01-02 101. 
## 3 2016-01-03 100. 
## 4 2016-01-04  97.1
```

---

# Інші смаколики tidyr

Використовуйте `crossing`, щоб отримати повну комбінацію групи змінних.&lt;sup&gt;1&lt;/sup&gt;


```r
crossing(side=c("left", "right"), height=c("top", "bottom"))
```

```
## # A tibble: 4 x 2
##   side  height
##   &lt;chr&gt; &lt;chr&gt; 
## 1 left  bottom
## 2 left  top   
## 3 right bottom
## 4 right top
```

```r
## expand_grid() аналогічна функція але без сортування
```

.footnote[
&lt;sup&gt;1&lt;/sup&gt; Base R альтернатива: `expand.grid`.
]  

--

Перегляньте розділи `?expand` і `?complete` для отримання більш спеціалізованих функцій, які дозволяють заповнювати (неявно) відсутні дані або створювати комбінації даних.
- Ви зіткнетеся з цим під час наступного завдання.

---
class: inverse, center, middle
name: summary

# Підсумок
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=1100px&gt;&lt;/html&gt;

---

# Ключові функції

### dplyr
1. `filter`
2. `arrange`
3. `select`
4. `mutate`
5. `summarise`

### tidyr
1. `pivot_longer`
2. `pivot_wider`
3. `separate`
4. `unite`

--

Інші корисні штуки: пайпи (`%&gt;%`), групування (`group_by`), об'єднання (`left_join`, `inner_join`, тощо).


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
